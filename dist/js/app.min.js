function AppViewModel(locations){var self=this;self.markers=ko.observableArray(markers),self.populateInfoWindow=function(){populateInfoWindow(this,InfoWindow),this.toggleBounce()},self.filter=ko.observable(""),self.filteredItems=ko.computed(function(){var filter=self.filter().toLowerCase();if(filter)return ko.utils.arrayFilter(markers,function(marker){return ko.utils.stringStartsWith(marker.title.toLowerCase(),filter)?(marker.setVisible(!0),marker):void marker.setVisible(!1)});if(!markers.length)for(i=0;i<locations.length;i++)addMarker(locations[i]);return markers.forEach(function(marker){marker.setVisible(!0)}),markers})}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:33.749,lng:-84.388},zoom:14}),infoWindow=new google.maps.InfoWindow,bounds=new google.maps.LatLngBounds,ko.applyBindings(new AppViewModel(locations))}function addMarker(location){var marker=new google.maps.Marker({position:{lat:location.position.lat,lng:location.position.lng},map:map,title:location.title,animation:google.maps.Animation.DROP,populateInfoWindow:populateInfoWindow,image:"",getImage:function(){var marker=this;fetch(" https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key="+FLICKR_API_KEY+"&per_page=1&radius=0.1&lat="+location.position.lat+"&lon="+location.position.lng+"&format=json&nojsoncallback=1").then(function(response){return response.json()}).then(function(j){var photoData=j.photos.photo[0],farm=photoData.farm,photoID=photoData.id,secretID=photoData.secret,server=photoData.server;setImage(marker,"<img src=https://farm"+farm+".staticflickr.com/"+server+"/"+photoID+"_"+secretID+".jpg")}).catch(function(err){setImage(marker,"<h1>Failed to get image</h1>")})},toggleBounce:function(){markers.forEach(function(marker){marker.setAnimation(null)}),null!==this.getAnimation()?this.setAnimation(null):this.setAnimation(google.maps.Animation.BOUNCE)}});marker.getImage(),marker.addListener("click",function(){this.toggleBounce(),this.populateInfoWindow(this,infoWindow)}),markers.push(marker),bounds.extend(marker.position),map.fitBounds(bounds)}function populateInfoWindow(marker,infoWindow){infoWindow.marker=marker,infoWindow.setContent('<div class="infowindow"><h1>'+marker.title+"</h1><br>"+marker.image+"<br><p>Recent flickr upload of "+marker.title+"</p></div>"),infoWindow.open(map,marker),infoWindow.addListener("closeclick",function(){marker.setAnimation(null)})}function mapError(){"use strict";alert("Failed to load map")}function setImage(marker,image){return marker.image=image,image}var map,bounds,infoWindow,locations,FLICKR_API_KEY="c409285ba83e15950d72eddb6f85a5ec",markers=[],locations=[{title:"World of Coca-Cola",position:{lat:33.7628,lng:-84.3928}},{title:"Centennial Olympic Park",position:{lat:33.7608,lng:-84.3931}},{title:"Six Flags",position:{lat:33.7681,lng:-84.5513}},{title:"Fox Theatre",position:{lat:33.7726,lng:-84.3856}},{title:"Turner Field",position:{lat:33.7348,lng:-84.39}},{title:"Philips Arena",position:{lat:33.7573,lng:-84.3963}},{title:"Georgia Dome",position:{lat:33.7577,lng:-84.4008}},{title:"Zoo Atlanta",position:{lat:33.7322,lng:-84.3713}}];ko.utils.stringStartsWith=function(string,startsWith){return string=string||"",!(startsWith.length>string.length)&&string.substring(0,startsWith.length)===startsWith},window.onresize=function(){map.fitBounds(bounds)};